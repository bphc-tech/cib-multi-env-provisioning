{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.34.1.11899",
      "templateHash": "1618875621424921655"
    }
  },
  "parameters": {
    "factoryName": {
      "type": "string",
      "metadata": {
        "description": "Factory name parameter"
      }
    },
    "connections_azureblob_1_name": {
      "type": "string",
      "defaultValue": "azureblob-1"
    },
    "connections_azureblob_2_name": {
      "type": "string",
      "defaultValue": "azureblob-2"
    },
    "connections_azureblob_3_name": {
      "type": "string",
      "defaultValue": "azureblob-3"
    },
    "connections_azureblob_4_name": {
      "type": "string",
      "defaultValue": "azureblob-4"
    },
    "connections_azureblob_5_name": {
      "type": "string",
      "defaultValue": "azureblob-5"
    },
    "actionGroups_Email_Alicia_name": {
      "type": "string",
      "defaultValue": "Email_Alicia"
    },
    "connections_PA_VPN_name": {
      "type": "string",
      "defaultValue": "PA-VPN"
    },
    "networkInterfaces_vm2_name": {
      "type": "string",
      "defaultValue": "vm2"
    },
    "storageAccounts_devdatabphc_name": {
      "type": "string",
      "defaultValue": "databphc"
    },
    "routeTables_RouteTable_name": {
      "type": "string",
      "defaultValue": "RouteTable"
    },
    "virtualNetworks_Network_name": {
      "type": "string",
      "defaultValue": "Network"
    },
    "serverfarms_ASP_Network_name": {
      "type": "string",
      "defaultValue": "ASP-Network"
    },
    "storageAccounts_testnetwork93cd_name": {
      "type": "string",
      "defaultValue": "testnetwork93cd"
    },
    "SharePointOnlineList_Jan28_servicePrincipalKey": {
      "type": "string"
    },
    "sites_SharePointDataExtractionFunction_name": {
      "type": "string",
      "defaultValue": "SharePointDataExtractionFunction"
    },
    "publicIPAddresses_GatewayIP_name": {
      "type": "string",
      "defaultValue": "GatewayIP"
    },
    "metricAlerts_EmailOnADFActionFailure_name": {
      "type": "string",
      "defaultValue": "EmailOnADFActionFailure"
    },
    "metricAlerts_EmailOnADFPipelineFailure_name": {
      "type": "string",
      "defaultValue": "EmailOnADFPipelineFailure"
    },
    "localNetworkGateways_LocalNetworkGateway_name": {
      "type": "string",
      "defaultValue": "LocalNetworkGateway"
    },
    "privateDnsZones_privatelink_dfs_core_windows_net_name": {
      "type": "string",
      "defaultValue": "privatelink.dfs.core.windows.net"
    },
    "privateDnsZones_privatelink_blob_core_windows_net_name": {
      "type": "string",
      "defaultValue": "privatelink.blob.core.windows.net"
    },
    "privateDnsZones_privatelink_datafactory_azure_net_name": {
      "type": "string",
      "defaultValue": "privatelink.datafactory.azure.net"
    },
    "privateEndpoints_dmiprojectsstorage_private_endpoint_name": {
      "type": "string",
      "defaultValue": "dmiprojectsstorage-private-endpoint"
    },
    "virtualNetworkGateways_VirtualNetworkGateway1_name": {
      "type": "string",
      "defaultValue": "VirtualNetworkGateway1"
    },
    "privateEndpoints_dmi_projects_factory_private_endpoint_name": {
      "type": "string",
      "defaultValue": "dmi-projects-factory-private-endpoint"
    },
    "factories_data_modernization_externalid": {
      "type": "string",
      "defaultValue": "/subscriptions/694b4cac-9702-4274-97ff-3c3e1844a8dd/resourceGroups/Network/providers/Microsoft.DataFactory/factories/data-modernization"
    },
    "factories_dmi_projects_factory_externalid": {
      "type": "string",
      "defaultValue": "/subscriptions/694b4cac-9702-4274-97ff-3c3e1844a8dd/resourceGroups/Network/providers/Microsoft.DataFactory/factories/dmi-projects-factory"
    },
    "storageAccounts_dmiprojectsstorage_externalid": {
      "type": "string",
      "defaultValue": "/subscriptions/694b4cac-9702-4274-97ff-3c3e1844a8dd/resourceGroups/Network/providers/Microsoft.Storage/storageAccounts/dmiprojectsstorage"
    },
    "virtualNetworks_Prod_VirtualNetwork_externalid": {
      "type": "string",
      "defaultValue": "/subscriptions/2b7c117e-2dba-4c4a-9cd0-e1f0dfe74b03/resourceGroups/Prod-Network/providers/Microsoft.Network/virtualNetworks/VirtualNetwork"
    }
  },
  "resources": [
    {
      "type": "Microsoft.DataFactory/factories",
      "apiVersion": "2018-06-01",
      "name": "[parameters('factoryName')]",
      "location": "[resourceGroup().location]",
      "properties": {}
    },
    {
      "type": "microsoft.insights/activityLogAlerts",
      "apiVersion": "2017-04-01",
      "name": "DataFactoryAlert",
      "location": "[resourceGroup().location]",
      "properties": {
        "scopes": [
          "[resourceId('Microsoft.DataFactory/factories', parameters('factoryName'))]"
        ],
        "condition": {
          "allOf": [
            {
              "field": "status",
              "equals": "Failed"
            }
          ]
        },
        "actions": [
          {
            "actionGroupId": "[resourceId('Microsoft.Insights/actionGroups', parameters('actionGroups_Email_Alicia_name'))]"
          }
        ]
      },
      "dependsOn": [
        "[resourceId('Microsoft.DataFactory/factories', parameters('factoryName'))]"
      ]
    },
    {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2021-04-01",
      "name": "[parameters('storageAccounts_devdatabphc_name')]",
      "location": "[resourceGroup().location]",
      "sku": {
        "name": "Standard_LRS"
      },
      "kind": "StorageV2",
      "properties": {}
    },
    {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2021-04-01",
      "name": "[parameters('storageAccounts_testnetwork93cd_name')]",
      "location": "[resourceGroup().location]",
      "sku": {
        "name": "Standard_LRS"
      },
      "kind": "Storage",
      "properties": {}
    },
    {
      "type": "Microsoft.Web/connections",
      "apiVersion": "2016-06-01",
      "name": "[parameters('connections_azureblob_1_name')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "displayName": "[parameters('connections_azureblob_1_name')]"
      }
    },
    {
      "type": "Microsoft.Web/connections",
      "apiVersion": "2016-06-01",
      "name": "[parameters('connections_azureblob_2_name')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "displayName": "[parameters('connections_azureblob_2_name')]"
      }
    },
    {
      "type": "Microsoft.Web/connections",
      "apiVersion": "2016-06-01",
      "name": "[parameters('connections_azureblob_3_name')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "displayName": "[parameters('connections_azureblob_3_name')]"
      }
    },
    {
      "type": "Microsoft.Web/connections",
      "apiVersion": "2016-06-01",
      "name": "[parameters('connections_azureblob_4_name')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "displayName": "[parameters('connections_azureblob_4_name')]"
      }
    },
    {
      "type": "Microsoft.Web/connections",
      "apiVersion": "2016-06-01",
      "name": "[parameters('connections_azureblob_5_name')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "displayName": "[parameters('connections_azureblob_5_name')]"
      }
    },
    {
      "type": "Microsoft.Web/serverfarms",
      "apiVersion": "2021-02-01",
      "name": "[parameters('serverfarms_ASP_Network_name')]",
      "location": "[resourceGroup().location]",
      "sku": {
        "name": "S1",
        "tier": "Standard"
      },
      "properties": {
        "reserved": false
      }
    },
    {
      "type": "Microsoft.Web/sites",
      "apiVersion": "2021-02-01",
      "name": "[parameters('sites_SharePointDataExtractionFunction_name')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarms_ASP_Network_name'))]",
        "siteConfig": {
          "linuxFxVersion": "DOTNETCORE|3.1"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarms_ASP_Network_name'))]"
      ]
    }
  ]
}
